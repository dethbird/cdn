{% extends 'layout.twig' %}

{% block title %}Personal CDN{% endblock %}

{% block content %}
  {% if upload_info is defined %}
    <div class="notification is-success">
      <strong>Upload received</strong>
      <div>Title: {{ upload_info.title|e }}</div>
      <div>Project: {{ upload_info.project|e }}</div>
      <div>Filename: {{ upload_info.filename|e }}</div>
      <div>Size: {{ upload_info.size is not null ? upload_info.size : 'unknown' }}</div>
      <div>Type: {{ upload_info.media_type|e }}</div>
    </div>
  {% endif %}
  <div class="box">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:1rem">
      <form method="get" class="field has-addons" style="flex:1">
      <div class="control is-expanded">
        <input class="input" name="project" placeholder="filter by project" value="{{ project|e }}" />
      </div>
      <div class="control">
        <button class="button is-info">Filter</button>
      </div>
      </form>
      <div>
        <a class="button is-primary" href="/upload">Add</a>
      </div>
    </div>
  </div>

  <div class="box">
    <div class="table-container">
  <table class="table is-fullwidth is-hoverable has-text-centered">
        <thead>
          <tr>
            <th class="has-text-centered">Kind</th>
            <th class="has-text-centered">Project</th>
            <th class="has-text-centered">Title</th>
            <th class="has-text-centered">URL</th>
            <th class="has-text-centered">Renditions</th>
            <th class="has-text-centered">Metrics</th>
            <th class="has-text-centered">Size</th>
            <th class="has-text-centered">Created</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
            <tr>
              <td class="has-text-weight-semibold">{{ it.kind|e }}</td>
              <td>{{ it.project|e }}</td>
              <td>{{ it.title|e }}</td>
              <td class="url">
                {% if it.kind == 'image' %}
                  {% if it.url_1200 %}<div><a href="{{ it.url_1200|e }}" target="_blank">1200</a></div>{% endif %}
                  {% if it.url_800 %}<div><a href="{{ it.url_800|e }}" target="_blank">800</a></div>{% endif %}
                {% else %}
                  <a href="{{ it.url_main|e }}" target="_blank">{{ it.url_main|e }}</a>
                {% endif %}
              </td>
              <td>
                {% if it.kind == 'image' and it.url_800 %}
                  <div style="margin-bottom:.5rem"><a href="{{ it.url_800|e }}" target="_blank"><img src="{{ it.url_800|e }}" alt="{{ it.title|e }}" style="max-width:150px;max-height:100px;object-fit:cover;border:1px solid #eee;padding:2px;background:#fff"/></a></div>
                {% endif %}
              </td>
              <td>
                {% if it.kind == 'image' and it.width and it.height %}
                  {{ it.width }} Ã— {{ it.height }}
                {% elseif it.kind == 'audio' and it.duration_sec is defined and it.duration_sec %}
                  {{ it.duration_sec }}s
                {% else %}
                  &nbsp;
                {% endif %}
              </td>
              <td>{{ it.size_human }}</td>
              <td>{{ it.created_at }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  
{% endblock %}
