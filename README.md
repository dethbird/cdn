# Personal CDN for Fountain Writer

Slim 4 + PHP 8 + SQLite + ffmpeg + ImageMagick. Upload images/audio, transcode, and serve via Apache with long caching.

## Install
```bash
composer install
cp .env.example .env
# edit UPLOAD_TOKEN and paths
composer start
# http://localhost:8080/
```
Ensure Apache points `DocumentRoot` to `public/` and has mod_rewrite+expires+headers enabled.

## Upload
```bash
curl -X POST http://host/api/upload   -H "Authorization: Bearer $UPLOAD_TOKEN"   -F "project=<PROJECT_ID>" -F "title=Rooftop"   -F "file=@/path/to/image-or-audio"
```

## Upload storage & URLs

Uploaded media are stored under `public/m/<media-id>/` on disk. Filenames and public URLs are generated by the app as follows:

 - Images (two renditions, WebP):
	- Disk: `public/m/<id>/<id>-1200.webp` and `public/m/<id>/<id>-800.webp`
	- Public URLs: `https://<host>/m/<id>/<id>-1200.webp` and `https://<host>/m/<id>/<id>-800.webp`
	- `url_main` in the DB points to the 1200 rendition by default.
- Audio:
	- Disk: `public/m/<id>/<id>.mp3`
	- Public URL: `https://<host>/m/<id>/<id>.mp3`

The application creates the `public/m/<id>` directory when a media item is uploaded and stores the generated filenames/URLs in the `media` table.

## Login

The admin UI is protected by a single-user password. The app uses PHP's password_hash()/password_verify(). To set or change the password, generate a password hash on the server and add it to your `.env` file.

1. Generate a hash (run on your VM where PHP is installed):

```bash
php -r "echo password_hash('your-chosen-password', PASSWORD_DEFAULT) . PHP_EOL;"
```

2. Edit (or create) `.env` in the project root and add the following line (paste the generated hash):

```text
UPLOAD_PASSWORD_HASH=$2y$10$...generated-hash...
```

3. Restart your webserver if needed (php-fpm/Apache):

```bash
# example for PHP-FPM on Linux
sudo systemctl restart php8.1-fpm
# or restart Apache
sudo systemctl restart apache2
```

4. Open the login page at `http://<your-host>/login` and sign in with your chosen password.

Security notes:
- Keep `.env` out of version control. If the file is tracked, run `git rm --cached .env` and commit.
- Use HTTPS in production and set secure session cookie flags.
